---
- name: Respond to new GitHub issue
  hosts: localhost
  gather_facts: false
  collections:
    - community.general
  vars:
    repo_owner: "{{ ansible_eda.event.payload.repository.owner.login }}"
    repo_name: "{{ ansible_eda.event.payload.repository.name }}"
    issue_number: "{{ ansible_eda.event.payload.issue.number }}"
    issue_url: "https://api.github.com/repos/{{ repo_owner }}/{{ repo_name }}/issues/{{ issue_number }}"
    headers:
      Authorization: "Bearer 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"
      Accept: "application/vnd.github.v3+json"

  tasks:
    - name: Debug the issue info
      debug:
        msg: |
          ğŸ› New issue created!
          Title: {{ ansible_eda.event.payload.issue.title }}
          Body: {{ ansible_eda.event.payload.issue.body }}
          URL: {{ ansible_eda.event.payload.issue.html_url }}
    - name: Create a namespace
      kubernetes.core.k8s:
        state: present
        api_version: v1
        kind: Namespace
        name: "{{ ansible_eda.event.payload.issue.body }}"
    - name: Post a comment on the GitHub issue
      community.general.github_issue_comment:
        token: "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"
        repo_owner: "{{ repo_owner }}"
        repo_name: "{{ repo_name }}"
        issue_number: "{{ issue_number }}"
        body: "ğŸ‘‹ Thanks for creating this issue! your namespace {{ ansible_eda.event.payload.issue.body }} is now created!!!."
